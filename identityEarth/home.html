<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>HOME</title>
    <link rel="stylesheet" type="text/css" href="identityEarth-style.css">
    <link rel="stylesheet" href="https://use.typekit.net/dbh8opd.css">
    <script src="https://d3js.org/d3.v4.min.js"></script>
  </head>
  <body id="Body" background="assets/space-bg.jpg">
    <h1>UNE System Planet Comparison</h1>
    <h2 id="legend">Now showing: Earth's size compared to the size of Mercury</h2>
    <svg id="space">
      <g id="xAxis"></g>
    </svg>
    <div class="custom-select">
      <select id="planetSelect" onchange="drawPlanets()">
        <option value="Mercury">Mercury
        <option value="Venus">Venus
        <option value="Mars">Mars
        <option value="Jupiter">Jupiter
        <option value="Saturn">Saturn
        <option value="Uranus">Uranus
        <option value="Neptune">Neptune
      </select>
    </div>
    <div class="custom-select">
      <select id="dataPointSelect" onchange="drawPlanets()" class="custom-select">
        <option value="radius">Radius
        <option value="gravity">Gravity
        <option value="dayLength">Average Day Length
        <option value="moons">Number of Moons
      </select>
    </div>
  </body>
  <script>
    //Global Variables
    var planetData;

    //Data Loading
    d3.queue()
      .defer(d3.csv, "identityEarth.csv")
      .awaitAll(function(error, dataArray) {
        planetData = dataArray[0];
        planetData.forEach(function(planet) {
          planet.radius = parseFloat(planet.radius);
          planet.gravity = parseFloat(planet.gravity);
          planet.dayLength = parseFloat(planet.dayLength);
          planet.surfaceTempLow = parseFloat(planet.surfaceTempLow);
          planet.surfaceTempHigh = parseFloat(planet.surfaceTempHigh);
          planet.moons = parseFloat(planet.moons);
        });
        console.log(planetData);
        drawPlanets();
      });

    //SVG Styles
    var padding = 425;
    var svg = d3.select("#space")
      .attr("width", window.innerWidth)
      .attr("height", 500);

    //Draw Functions
    var drawPlanets = function() {

      var otherPlanet = document.getElementById("planetSelect").value;
      var indicator = document.getElementById("dataPointSelect").value;
      var filteredData = planetData.filter(function(d) {
        return d.name == "Earth" || d.name == otherPlanet;
      });
      function legendUpdate(){
          var legend = document.getElementById("legend");
          var otherPlanet = document.getElementById("planetSelect").value;
          var indicator = document.getElementById("dataPointSelect").value;
          legend.innerHTML = "Now showing: Earth's " + indicator + " compared to the " + indicator + " of " + otherPlanet
      };
      legendUpdate();

      var maxIndicator = d3.max(filteredData, function(d) {
        return d[indicator];
      });
      var minIndicator = d3.min(filteredData, function(d) {
        return d[indicator];
      });
      var radiusScale = d3.scaleLinear()
        .domain([0, maxIndicator])
        .range([0, 225]);
      var xScale = d3.scaleLinear()
        .domain([minIndicator, maxIndicator])
        .range([padding, window.innerWidth - padding]);
        console.log(window.innerWidth);

      var svg = d3.select("#space");
      var planets = svg.selectAll(".planet")
        .data(filteredData);

      // draw circles
      var planetEnters = planets.enter().append("circle")
        .attr("class", "planet")
        .attr("r", function(dataPoint) {
          return radiusScale(dataPoint[indicator]);
        })
        .attr("fill", "white")
        .attr("cx", function(d) {
          return xScale(d[indicator]);
        })
        .attr("cy", 250)
        .transition()

      // update circles
      planets.merge(planetEnters)
        .transition()
        .duration(1000)
        // .attr("cx", function(dataPoint, index) {
        //   return padding + (dataPoint[indicator] / 2);
        // })
        .attr("r", function(dataPoint) {
          return radiusScale(dataPoint[indicator]);
        })
      console.log(filteredData);

      // exit circles
      planets.exit()
        .transition()
        .duration(1000)
        .attr("r", 0)
        .remove();
    };

    </script>
</html>
